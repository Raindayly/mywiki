<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yly.wiki.mapper.MyEbookMapper">

    <update id="updateEbookInfo">
        update ebook t1,(SELECT ebook_id,count(1) doc_count,sum(vote_count)
            vote_count,sum(view_count) view_count from doc group by ebook_id) t2
        set t1.view_count = t2.view_count,t1.vote_count = t2.vote_count,t1.doc_count = t2.doc_count
        where t1.id = t2.ebook_id
    </update>
    <select id="getEbookStatistic">
        select t1.`date` as `date`,
               sum(t1.view_count) as viewCount,
               sum(t1.vote_count) as voteCount,
               sum(t1.view_increase) as voteIncrease,
               sum(t1.vote_increase) as voteIncrease,
        from ebook_snapshot t1
        where t1.`date` >= date_sub(curdate(), interval 1 day),
        group by t1.`date`
        order by t1.`date` asc
    </select>
</mapper>